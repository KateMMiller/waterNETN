---
output: html_document
title: "Using waterNETN R pkg." 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width = 10)
```

```{css echo = FALSE}
.indent {
margin-left: 25px;
font-size: 14px;
}

.indent2 {
margin-left: 50px;
font-size: 12px;
}

.drop{
  font-family: "Arial",Arial,sans-serif;
  font-size: 16px;
  font-weight: bold;
  padding:0px 0px 0px 0px;
  margin:0px 0px 0px 0px;
}

.fxn{
  color:#1942B5;
  font-size:14px;
  font-weight: bold;
}

.title{
 display:none;
}
/*
h4{
  color:#1942B5;
}
*/
```

```{r echo = F, include = F}
print_head <- function(df){
  knitr::kable(df[1:6,]) |> #, table.attr = "style='width:60%;'") |> 
    kableExtra::kable_classic(full_width = F, font_size = 12, 
                              bootstrap_options = c("condensed"))
}
library(tidyverse)
park = 'all';site = 'all'; site_type = 'all'; years = 2006:2023; months = 1:12; output = 'short'
parameter = c("ANC", "NH3", "pH", "Temp_C", "SDepth_m", "Discharge_csf", "PenetrationRatio");
... = NULL; smooth = F; layers = c("points", "lines"); threshold = T; legend_position = 'bottom'; span = 0.6
```

## Using the waterNETN R package {.tabset .tabset-pills}

### Getting started {.tabset}

#### Installation
<h4><b>Step 1.</b> Install R, RStudio, and RTools in Software Center</h4>
<h4><b>Step 2.</b> Install devtools package in R:</h4>
```{r, eval = F, class.source = "indent"}
install.packages('devtools')
```
<h4><b>Step 3.</b> Install waterNETN from github</h4>
Note that whenever the `waterNETN` package is updated, you can rerun this code to install the latest version.
```{r, eval = F, class.source = "indent"}
library(devtools)
install_github("KateMMiller/waterNETN")
```
<h4><b>Step 4.</b> Load waterNETN R package</h4>
```{r, class.source = "indent"}
library(waterNETN)
```
<h4><b>Step 5.</b> Import data</h4>
Note that R is not able to connect to files on Sharepoint or MS Teams (b/c Teams also stores all files on Sharepoint). That means you need to store data package files on your local machine or on a server (e.g. NETN Z drive). The default option for importing data will add the data package views (i.e., flatfiles) to an environment called VIEWS_WQ to your Environment work space (i.e. Environtment tab in top right panel). If you would rather import each individual view into your R session, specify with the new_env argument (e.g., `importData(new_env = F)`).
```{r echo = F, results = 'hide', include = F}
importData()
```
<p class = 'indent'>
<span style='color:#1942B5;'><b>Option 1.</b> Import data via .csv files. The file path should be where csvs are on your machine or server.</span></p>
```{r, eval = F, class.source = "indent"}
importData(type = 'csv',
           filepath = "C:/NETN/R_Dev/Water/data") # update filepath to your computer
```
<p class = 'indent'>
<span style='color:#1942B5;'><b>Option 2.</b> Import data via zip file of csvs. The filepath should be the location and name of the zip file.</span></p>
```{r eval = F, class.source = "indent"}
importData(type = 'zip',
           filepath = "C:/NETN/R_Dev/Water/data/NETN_Water_Data_Package_20240423.zip")
```
<p class = 'indent'>
<span style='color:#1942B5;'><b>Option 3.</b> Import data via data package database file on your computer</span></p>
```{r eval = F, class.source = "indent"}
importData(type = 'dbfile',
           filepath = "C:/NETN/R_Dev/Water/data/NETN_h3Ov4_DataPackage_202331115.accdb")
```
<p class = 'indent'>
<span style='color:#1942B5;'><b>Option 4.</b> Import data via data package database DSN (Data Source Name) on your computer. </span>
Note that this is the default setting. As long as you have a named DSN called "NETNWQ_DP" that links to the data package database, and that database links to the latest NETN WQ backend database, the code below will run. See <i>Setting up DSN</i> tab for how to set up DSN.</p>
```{r eval = F, class.source = "indent"}
importData() # easiest
importData(type = 'DSN', odbc = "NETNWQ_DP") # equivalent to line above
```
<h4><b>Step 6.</b> (Optional) Export data package to zip </h4>
You can export all of the csvs to a zip file with the day's date stamped on the file name. This allows you to import the tables from the database, then export the csvs as one zip file.
```{r eval = F, class.source = "indent"}
importData() # easiest
exportData(filepath = "./data", zip = TRUE) 
```

```{r eval = F, echo = F, class.source = "indent"}
importData() # easiest
exportData(filepath = "../data", zip = TRUE) 
```

<h4><b>Step 7. Play with the data</b></h4>
The functions in the `waterNETN` package are designed to work with the views, and are the best way to interact with the data to query by park, site, site type, year, parameter, etc. However, if you want to view the raw data, and you imported the data into the VIEWS_WQ environment, you can access them with the code below:
```{r eval = F}
# See list of the views
names(VIEWS_WQ)

# View one of the views
View(VIEWS_WQ$Chemistry_Data)

# Assign a view to a data frame named chem in R. Interact with chem the way you would work with any normal data frame in R. 
chem <- VIEWS_WQ$Chemistry_Data

```

If you want to use the `print_head()` function that shows output in the markdown, run the code below. This makes the results print cleaner in the markdown report. For your purposes, you can just run: `head(dataframe)`.
```{r}
print_head <- function(df){
  knitr::kable(df[1:6,]) |> #, table.attr = "style='width:60%;'") |> 
    kableExtra::kable_classic(full_width = F, font_size = 12, 
                              bootstrap_options = c("condensed"))
}

```
#### Getting help
<h4><b>Getting (and improving) help</b></h4>
The functions in `waterNETN` have help documentation like any R package. To view the help, you can go to the Packages tab and click on waterNETN (see below). That will show you all the functions in the package. Clicking on individual functions will take you to the help documentation for that function. 
```{r echo = F, out.height = 150, fig.align = 'center'}
knitr::include_graphics("C:/NETN/R_Dev/Water/waterNETN/testing_scripts/finding_R_package.jpg")
```

<p class = 'fxn'>You can also see the help of a function by running, for example: </p>
```{r, class.source = 'indent', eval = F}
?importData
```

<p class = 'fxn'>If `waterNETN` isn't loaded yet, you'd run: </p>
```{r, class.source = 'indent', eval = F}
?waterNETN::importData
```

Each function's help includes a Description, Usage (i.e. function arguments and their defaults), Argument options/definitions, and several examples showing how the function can be used. 

<b><span style='color:red;'>This is where you come in! If you notice typos or can think of better descriptions, examples, error messages, etc., please send them my way!</b></span> After we're more comfortable with R packages and get versed on GitHub, you'll be able to make those changes directly in the package. For now, you can just send me your suggestions and I'll make the changes.

Finally, if you ever want to peak under the hood at the function, you can view it several ways. 
<ol>
<li>Keep F2 key pressed and click on the function name in R. This trick works for many but not all functions in R.</li>
<li>View code in the <a href="https://github.com/KateMMiller/waterNETN/tree/main">GitHub katemmiller/waterNETN repo</a>. The functions are in the R folder. 

#### Setting up DSN
<h4><b>Setting up a DSN</b></h4>
<ol>
<li>Go to Windows Start Menu and search ODBC. Click on ODBC Data Sources (64-bit) </li>

```{r echo = F, out.height = 350, fig.align = 'center'}
knitr::include_graphics("C:/NETN/R_Dev/Water/waterNETN/testing_scripts/ODBC_step_1.jpg")
```
<li>Click on <i>Add</i>, then select <i>Microsoft Access Driver (\*.mdb, \*.accdb)</i> then click <i>Finish</i> in next menu.</li>

```{r echo = F, out.height = 400, fig.align = 'center'}
knitr::include_graphics("C:/NETN/R_Dev/Water/waterNETN/testing_scripts/ODBC_step_2.jpg")
```

<li>Enter <b>NETNWQ_DP</b> into the Data Source Name (red arrow), click on Select (red circle). In new window, click on C:/ (orange arrow) and find the path to your database. If it's on the Z drive, then click on the Drives window and select correct Drive. Click on the data package database (yellow arrow). When complete, click OK. Finally, add the name of the database file to the Description (blue arrow), so it's easier to check whether you're using the latest version.  </li>
```{r echo = F, out.height = 400, fig.align = 'center'}
knitr::include_graphics("C:/NETN/R_Dev/Water/waterNETN/testing_scripts/ODBC_step_3.jpg")
```

<li>If updating an existing DSN, follow similar process, except click on the DSN in the first window and select <i>Configure</i> instead of Add.</li>
</ol>

### get Data functions {.tabset}
#### getClimDaymet()
Daymet data are 1km gridded daily climate data, similar to PRISM data, but with more daily data associated with each location and more efficient downloading process (extract data from lat/long points, rather than download nationwide raster files and extract manually). Daymet data go back to 1980. See <a href="https://daymet.ornl.gov/">https://daymet.ornl.gov/</a> for more information. Another benefit of Daymet over PRISM is the data can be used to calculate drought indices, like Standardized Precipitation-Evapotranspiration Index (SPEI). Note: I'll eventually add SPEI metrics to the output of this function. 

Daymet data are typically available for a calendar year a a few months into the next year.

In waterNETN, you can download Daymet data by park, site, site type, and spanning years 1980 to 2023. See examples below. The larger the number of sites and years, the longer it can take. I added the option to save the data as a csv to disk via `export = T` and specifying a `filepath`, so you don't have to download these data over and over. I'll make it possible to read csvs into R to work with climate summary and plotting functions.  

<p class = 'fxn'>The following code downloads Daymet data for East Primrose Brook in MORR for the entire monitoring period, and exports to a data folder in the working directory.</p>
```{r, eval = F}
prim <- getClimDaymet(site = "MORRSB", years = 2006:2023, export = T, 
                      filepath = "./data")
print_head(prim) # table of first 6 rows- this is a custom function I wrote to save on coding
```

```{r, echo = F}
prim <- getClimDaymet(site = "MORRSB", years = 2006:2023, export = T, 
                      filepath = "../data")
print_head(prim) # table of first 6 rows- this is a custom function I wrote to save on coding
```



```{r echo = F, include = F}
file.remove("../data/Daymet_climate_data_2006-2023.csv")
```

<p class = 'fxn'>The following code downloads Daymet data for all sites in MABI for 2023. Results are assigned to R session environment and not exported to data folder in the working directory.</p>
```{r}
# Daymet data for the Pogue and Pogue stream for 2023, but not exporting to disk.
mabi_dm <- getClimDaymet(park = "MABI", years = 2023)
print_head(mabi_dm)
```

#### getClimWStat()
For each NETN monitoring site, I used the `rnoaa` package to find all weather stations within 20km radius of each site's lat/long coordinates. I then checked the period of record for each of these sites. I selected the closest weather station with the longest period of record that included 2023 and 2024. This assessment was done at the park level, so the data for each site within a park is the same. The API used to download weather station data is <a href="data.rcc-acis.org">data.rcc-acis.org</a>. Unfortunately only temperature data are available for ACAD's McFarland Hill weather station (AKA MARS). ACAD's hourly precipitation data were downloaded separately from the NADP website <a href="http://nadp2.slh.wisc.edu/siteOps/ppt/">http://nadp2.slh.wisc.edu/siteOps/ppt/</a>. These data only go back to 2008 and were aggregated to daily total precipitation. This function is slower for ACAD as a result. Though note that data are downloaded at the park level, then joined with site-specific data. In other words, data are downloaded for a park x combination of years once, then joined to site-level data. Weather stations used and their distance from each site are included in the output.

<p class = 'fxn'>The following code downloads weather station data for all sites in ROVA the past 10 years and writes to a csv.</p>
```{r eval = F}
rova_ws <- getClimWStat(park = "ROVA", years = 2013:2023, export = T, 
                        filepath = "./data")
print_head(rova_ws)
```

```{r echo = F}
rova_ws <- getClimWStat(park = "ROVA", years = 2013:2023, export = T, 
                        filepath = "../data")
print_head(rova_ws)
```

```{r echo = F, include = F}
file.remove("../data/Weather_station_data_2013-2023.csv")
```
<p class = 'fxn'>The following code downloads weather station data for all lakes in ACAD in 2023, but doesn't export to disk.</p>
```{r}
acad_ws <- getClimWStat(park = "ACAD", site_type = "lake", years = 2023)
print_head(acad_ws)
```

#### getClimDrought()
This function downloads weekly drought index at the county level based on the U.S. Drought Monitor for each specified park or weather station nearest to a specified site. If downloading for multiple parks and multiple weeks/years, function may be slow. Returned data frame includes percent of county area in 5 levels of drought, with D0 = Abnormally Dry, D1 = Moderate Drought, D2 = Severe Drought, D3 = Extreme Drought, and D4 = Exceptional Drought. Also returned is the Drought Severity and Coverage Index, which ranges from 0 to 500, and is a weighted sum of area within each of the drought categories. A score of 500 indicates the entire area is in exceptional drought (D4). Where multiple counties occur in a park, data can be faceted by county if `dom_county = FALSE`. To only plot predominant county, specify dom_county = TRUE (default). Otherwise, only park-level data are returned, as the results won't vary by site within a park. Note that Drought Monitor reports data such that, when drought a level moves into a higher category (e.g. D1 = 10), the previous level (e.g. D0) is listed as 100. The columns with pct (e.g. D0pct) correct for that, so that D0 + ... + D05 + None = 100.For more info on the data, see <a href= "https://droughtmonitor.unl.edu/CurrentMap.aspx"><US Drought Monitor</a>

<p class='fxn'> Get drought info for MABI and SAGA sites for first week of May</p>
```{r}
mabisaga <- getClimDrought(park = c("MABI", "SAGA"), week_start = "05/01/2024")
print_head(mabisaga)
```

<p class='fxn'>Get drought info for both counties in MORR in 2023</p>
```{r}
morr <- getClimDrought(park = "MORR", years = 2023, dom_county = TRUE)
print_head(morr)
```

#### getSites() {.tabset}
##### getSites()
Query site-level data. This function combines columns in common between the Sites_Stream and Sites_Lake views. This is a good building block for other functions, but may be less helpful on its own. Though, one helpful use of this function is to get the site codes for a given park or site.

<p class = 'fxn'>Get site info for ACAD lakes</p>
```{r}
ACAD_lakes <- getSites(park = "ACAD", site_type = "lake")
```

<p class = 'fxn'>Get site info for the Pogue</p>
```{r}
pogue <- getSites(site = "MABIPA")
```

<p class = 'fxn'>List site codes and their full site name for SARA</p>
```{r}
sara_sites <- getSites(park = "SARA") |> select(SiteCode, SiteName)
print_head(sara_sites)
```

##### getSitesLake()
Query site-level data for lakes only. This returns lake-only columns in the Sites_Lake views
<p class = 'fxn'>Get site info for ACAD lakes</p>
```{r}
ACAD_str <- getSitesLake(park = "ACAD")
print_head(ACAD_str)
```

<p class = 'fxn'>Get all site info for the Pogue Pond</p>
```{r}
pogue <- getSitesLake(site = "MABIPA", output = 'verbose')
print_head(pogue)
```

##### getSitesStream()
Query site-level data for streams only. This returns stream-only columns in the Sites_Stream views
<p class = 'fxn'>Get site info for ACAD streams</p>
```{r}
ACAD_str <- getSitesStream(park = "ACAD")
print_head(ACAD_str)
```

<p class = 'fxn'>Get all site info for the Pogue Stream</p>
```{r}
poguestr <- getSitesStream(site = "MABISA", output = 'verbose')
print_head(poguestr)
```

#### getEvents()
Query water data by park, site, site_type, year and month. 

<p class = 'fxn'>Get event info for Witch Hole Pond in ACAD in 2023</p>
```{r}
ACAD_lakes <- getEvents(site = "ACWHOL", years = 2023)
print_head(ACAD_lakes)
```

<p class = 'fxn'>Get event info for all years in the Pogue</p>
```{r}
pogue <- getEvents(site = "MABIPA", years = 2006:2023)
print_head(pogue)
```

<p class = 'fxn'>Get date of sampling each site in lower NETN in May, 2023</p>
```{r}
lnetn_evs <- getEvents(park = "LNETN", years = 2023, months = 5) |> 
  select(SiteCode, SiteName, EventDate)
print_head(lnetn_evs) #just printing first 6 rows
```

#### getChemistry()
This function allows you to query the Chemistry_Data view by park, site, site type, year, month, parameter, and sample type. The returned data frame is long (i.e. stacked) to facilitate data summary and plotting. Note that sample depth is not a filter in getChemistry() as it is with the Sonde In Situ data. 

<p class = 'fxn'>Get N parameters for all sites and non-QAQC events in MIMA.</p> 
Note that `QC_type = "ENV"` is the default for this function, which returns only non-QAQC events. Note also the use of named objects for the arguments. This allows you to set them at the top of a script, rather than having to type them out repeatedly. You can then change them in 1 place (i.e., update the year to 2024) and rerun the code. 
```{r}
n_params <- c("NH3", "NH3_mgL", "NO2", "NO2_mgL", "NO2+NO3", 
              "NO2+NO3_mgL", "NO3", "NO3_ueqL", "TN", "TN_mgL")
period <- 2006:2023
mima_n <- getChemistry(park = "MIMA", years = period, parameter = n_params)
print_head(mima_n) # top 6 rows
```

<p class = 'fxn'>Get results for all surface samples, including QC samples, in Browns Brook in 2023 in ACAD</p>
```{r}
brbk <- getChemistry(site = "ACBRWN", QC_type = "all", param = "all", 
                     years = 2023)
print_head(brbk)
```

<p class = 'fxn'>Get ANC for LNETN parks for all years during month of May. Note that by not specifying years, all years by default will be included in the output.</p>
```{r}
anc <- getChemistry(park = "LNETN", param = "ANC", months = 5)
print_head(anc)
```

<p class = 'fxn'>Get  for ACAD lakes from 2021:2023 from all sample depths.</p>
```{r}
surf <- getChemistry(park = "ACAD", site_type = "lake", years = 2021:2023)
print_head(surf)
```

<p class = 'fxn'>Get censored and non-censored NH3 data for LNETN all years. Note the Flag column indicates the measurement is censored by reporting the detection limit used.</p>
```{r}
cens <- getChemistry(park = "LNETN", param = "NH3", include_censored = TRUE)
print_head(cens) 
```

#### getDischarge()
This function allows you to query the Discharge_Data view by park, site, site type, year, month, measurement method (e.g., flowtracker or pygmy), and measurement rating (e.g., E, G, F, P). Note that you can also return all columns or a reduced set of columns with the output argument. Default is output = 'short'. This function is set up to work with site_type = 'stream', so you don't have to specify that.

<p class = 'fxn'>Get discharge data for all LNETN sites and years measured with flowtracker </p>
```{r}
ft <- getDischarge(park = "LNETN", method = "Pygmy")
print_head(ft)
```

<p class = 'fxn'>Get discharge data for all ACAD streams with measurement rating of Excellent or Good </p>
```{r}
acad <- getDischarge(park = "ACAD", rating = c("E", "G"))
str(acad) # structure of returned data
```

#### getLightPen()
This function allows you to query the Light_Penetration_Data view by park, site, site type, year, and month. Again output = 'short' is the default. If specify output = 'verbose', you'll get all possible columns. This is only set up to work with site_type = 'lake', so you don't have to specify that.

<p class = 'fxn'>Get light penetration for Weir Pond from 2013 - 2023 all months.</p> 
```{r}
period <- 2013:2023
wefa <- getLightPen(park = "WEFA", years = period)
print_head(wefa) # top 6 rows
```

<p class = 'fxn'>Get light penetration for ACAD lakes in 2023 in July and August.</p> 
```{r}
acad <- getLightPen(park = "ACAD", years = 2023, months = 7:8)
print_head(acad) # top 6 rows
```

#### getSecchi()
This function allows you to query Secchi data by park, site, site type, years, months and whether you want to return all observations, the first or the second. Default returns all observations with data. Note that this function is designed to only work with lakes, and doesn't require site_type = "lake" to be specified.
<p class = 'fxn'>Get Secchi depth the Pogue from 2021-2023, first observer only</p>
```{r}
mabi <- getSecchi(site = "MABIPA", years = 2021:2023, observer_type = "first")
print_head(mabi)
```

<p class = 'fxn'>Get Secchi for all ACAD lakes sampled in July for all observers
```{r}
ACAD_lake <- getSecchi(park = 'ACAD', months = 7)
print_head(ACAD_lake)
```

#### getSondeInSitu()
This function allows you to query Sonde in situ data by park, site, site type, years, months, parameter, QC type, surface vs. all, etc. Default returns all non-QAQC observations with data. The Sonde_InSitu_Data view is large and can take a few seconds to run for most parks, sites, years, parameters, etc. Surface only measurements, defined as as the medium of all samples within 2m of the surface, are the default.

<p class = 'fxn'>Get Sonde data for all sites and parameters in MABI from 2021-2023 for non-QAQC samples</p>
```{r}
mabi <- getSondeInSitu(park = "MABI", years = 2021:2023)
print_head(mabi)
```

<p class = 'fxn'>get data for all DO parameters in MIMA from 2006-2023 for non-QAQC samples</p>
```{r}
params <- c("DOsat_pct", "DOsatLoc_pct", "DO_mgL")
period <- 2006:2023
mima_do <- getSondeInSitu(park = "MIMA", years = period, parameter = params)
print_head(mima_do)
```

<p class = 'fxn'>Get Temp data for all sample depths in Jordan Pond in ACAD for non-QAQC samples</p>
```{r}
ACAD_lake <- getSondeInSitu(site = 'ACJORD', parameter = "Temp_C", 
                            sample_depth = "all")
```

<p class = 'fxn'>Get pH for lower NETN parks from May to Oct for QAQC and non-QAQC samples</p>
```{r}
lnetn_ph <- getSondeInSitu(park = "LNETN", param = "pH", months = 5:10, 
                           QC_type = 'all')
```

#### getStreamObs()
This function allows you to query stream observation data by park, site, year and month
<p class = 'fxn'>Get stream observations for Pogue Stream all years</p>
```{r}
mabi <- getStreamObs(park = "MABI")
print_head(mabi)
```
<p class = 'fxn'>Get observations for all streams in ACAD May 2023 </p>
```{r}
ACAD_streams <- getStreamObs(park = 'ACAD', years = 2023, months = 5)
print_head(ACAD_streams)
```

#### getWaterLevel()
This function joins stage and water level data, and allows you to query by park, site, site_type, year, and month. Note that WL data start in 2013 in the view. 

<p class = 'fxn'>Get water level data for Bubble Pond. </p>
```{r}
bubl <- getWaterLevel(site = "ACBUBL", years = 2013:2023)
print_head(bubl)
```

<p class = 'fxn'>Get water level data for Weir Pond in August. </p>
```{r}
weir <- getWaterLevel(site = "WEFAPA", months = 8)
print_head(weir)
```

### Plotting Functions {.tabset}
#### plotTrend()
This function produces a smoothed trend plot filtered on park, site, year, month, and parameter.
It works with chemistry, Sonde in situ, Secchi depth, Light Penetration, and Discharge data. If multiple sites are specified, they will be plotted on the same figure. If multiple parameters are specified, they will be plotted on separate figures. 

There are several arguments to customize plots. 
<ul>
<li> Choose whether to include only active sites (default) or all sites that have been monitored via `active`. </li>
<li> Choose whether to add points, lines, or both (default) via `layers` argument. </li>
<li> If lines are chosen as a layer, choose whether to plot a loess smoothed line (default) or a line that connects the sample points via `smooth`. </li>
<li> Choose whether to plot any water quality thresholds that exist via `threshold`. Upper limits are dashed. Lower limits are dotted. </li>
<li> Choose whether to plot surface (default) or all depth measurements via `sample_depth`. </li>
<li> Choose whether to include censored values or not via `include_censored`. </li>
<li> Choose color palette via `palette`. Default is 'viridis', but other options are discrete palettes in RColorBrewer, including 'Set1', 'Dark2', and 'Accent'. </li>
<li> Choose position of legend via `legend_position`. If you don't want to show the legend, `legend_position = 'none'`.
</ul>


<details><summary class = 'drop'>Discrete RColorBrewer palettes are below:</summary>
```{r}
RColorBrewer::display.brewer.all(type = 'qual')
```
</details><br>

<details open><summary class='drop'>Single site; single parameter</summary>
<p class = 'fxn'>Plot non-smoothed surface pH for Eagle Lake for all years. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "ACEAGL", parameter = "pH", smooth = FALSE)

```

<p class = 'fxn'>Plot smoothed surface pH for Eagle Lake for past 3 years using default span of 0.3 and by default not including the legend. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "ACEAGL", parameter = "pH", palette = 'Dark2', years = 2021:2023)

```
<p class = 'fxn'>Plot smoothed surface pH for Eagle Lake for all years, removing the legend and using span of 0.75. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "ACEAGL", parameter = "pH", span = 0.75)

```

<p class = 'fxn'>Plot smoothed Secchi Depth in Jordan Pond for all years, including the legend, different color palette, and using span of 0.75. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "ACJORD", parameter = "SDepth_m", 
          span = 0.75, palette = 'Set1')

```

<p class = 'fxn'>Plot unsmoothed SO4 in Witch Hole Pond for all years, including censored values. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "ACWHOL", parameter = "SO4_ueqL", 
          smooth = F, include_censored = TRUE, legend_position = 'bottom')

```

<p class = 'fxn'>Plot unsmoothed line only for pH in Witch Hole Pond for all years. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "ACWHOL", parameter = "pH", layers = "lines", 
          smooth = F, legend_position = 'none')

```


</details>

<details open><summary class='drop'>Multiple sites or params</summary>
<p class = 'fxn'>Plot smoothed surface pH for active SARA streams over all years with 0.6 span. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(park = "SARA", site = c("SARASA", "SARASC", "SARASD"), 
          site_type = "stream", parameter = "pH", 
          legend_position = "right", span = 0.6)

```

<p class = 'fxn'>Plot smoothed surface SO4 for all MIMA streams over all years with 0.6 span. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(park = "MIMA", site_type = "stream", 
          parameter = "SO4_ueqL", legend_position = "right", span = 0.6)

```

<p class = 'fxn'>Plot non-smoothed surface of multiple Sonde parameters for all MIMA streams over all years with 0.6 span. </p>
```{r message = FALSE, warning = FALSE}
params <- c("Temp_C", "SpCond_uScm", "DOsat_pct", "pH")
plotTrend(park = "MIMA", site_type = "stream", 
          parameter = params, legend_position = "right", span = 0.6)

```

<p class = 'fxn'>Plot smoothed surface Secchi Depth, Penetration Ratio, pH, and DOC in Jordan Pond for all years, including the legend, different color palette, and using span of 0.75. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "ACJORD", parameter = c("SDepth_m", "PenetrationRatio", "pH", "DOC_mgL"), 
          span = 0.75, palette = 'Set1')

```

<p class = 'fxn'>Plot smoothed surface water depth in the Pogue for all years, including a different color palette, and using span of 0.75. </p>
```{r message = FALSE, warning = FALSE}
plotTrend(site = "MABIPA", parameter = "WaterLevelFeet", span = 0.75, 
          palette = 'Set1')

```

<p class = 'fxn'>Plot smoothed TN, TP and SO4 in all MORR sites for all years, including the legend, different color palette, and using span of 0.6. Thresholds, where they exist,  plot by default.</p>
```{r message = FALSE, warning = FALSE}
plotTrend(park = "MORR", parameter = c("TN_mgL", "TP_ugL", "SO4_ueqL"), 
          span = 0.6, legend_position = 'bottom', palette = 'accent')
```

</details>

#### plotLakeProfile()
This function produces a heatmap in 1-m bins filtered on park (mostly for ACAD), site, year, month, Sonde in situ parameter and either sample relative to the surface or relative to surface elevation. Can only specify one parameter at a time. If multiple sites or years are selected, plots will be faceted on those factors. Keep options limited for best plotting. 

The option to plot relative to surface elevation (eg depth_type = 'elev') corrects sample depth for elevation using water level data and datum elevation for that sampling event. The elevation-corrected option allows you to see how the water column is shifting over time, but currently only works for years >= 2013 in ACAD, as water levels prior to that are not in the current data package. Default setting is raw, where the raw sample depths are plotted instead of elevation.

Note that occasionally profiles skip a 1-m bin, which show up as white sections in the plots. Incomplete sampling in 2020 and 2021 also shows up as white sections. If you specify a lake x year x parameter combination that doesn't exist (e.g., a year a lake isn't sampled), the function will return an error message instead of an empty plot.

The width of the profiles take into account the number of days between sampling events. For the first and last months (typically May and October), the left/right side of the profiles are padded by 14 days. Otherwise, profile widths are centered on the sample day with the left side representing half the number of days between that visit and the previous visit and the right side representing half the number of days between that visit and the following visit. Black lines are the thermocline, as calculated by rLakeAnalyzer.  

There are several arguments to customize plots. 
<ul>
<li>Choose whether to plot the theromocline as points on each profile via `plot_thermocline = TRUE` (default). The thermocline is calculated by rLakeAnalyzer, and is the depth/elevation at which the largest change in temperature occurs in the sampled water column. If no thermocline is detected, as defined by `rLakeAnalyzer::thermo.depth()`, nothing is plotted.</li>
<li> Choose whether to include only active sites (default) or all sites that have been monitored via `active`. </li>
<li> Choose palette. Current enabled themes are 'viridis' (yellow - green - blue), and built in continuous color patterns in RColorBrewer. If you prefer other palettes, I can add those too. The only thing I'm trying to avoid is creating the palette manually, since number 1-m bins varies by site and across years. More info on built in ggplot scales can be found here: <a href="https://ggplot2-book.org/scales-colour">https://ggplot2-book.org/scales-colour</a>. </li>
<li> Choose position of legend via `legend_position`. If you don't want to show the legend, `legend_position = 'none'`.
<li> Include site name as plot title (title = TRUE). Only enabled when 1 site is selected. Otherwise site names will be in the facets.
</ul>

<details><summary = 'drop'>Continuous RColorBrewer palettes are below:</summary>
```{r}
RColorBrewer::display.brewer.all(type = 'div')
RColorBrewer::display.brewer.all(type = 'seq')

```
</details><br>

<details open><summary class='drop'>Simple plots</summary>
<p class = 'fxn'>Plot temperature for Upper Hadlock for years 2013 - 2023 corrected by elevation with thermocline plotted as black circles. </p>
```{r message = FALSE, warning = FALSE}
plotLakeProfile(site = "ACUHAD", parameter = "Temp_C", depth_type = 'elev', 
                years = 2013:2023)

```

<p class = 'fxn'>Plot temperature for Eagle Lake for years 2006 - 2023 with raw sample depth. Note that we can go back to 2006 because we're using raw sample depth instead of elevation.</p>
```{r message = FALSE, warning = FALSE}
plotLakeProfile(site = "ACEAGL", parameter = "Temp_C", depth_type = 'raw', 
                years = 2006:2023)

```

<p class = 'fxn'>Same plot as above, but with no plot title or thermocline. 
```{r message = FALSE, warning = FALSE}
plotLakeProfile(site = "ACEAGL", parameter = "Temp_C", depth_type = 'raw', 
                years = 2006:2023, plot_title = FALSE, plot_thermocline = F)

```


<p class = 'fxn'>Plot temperature for all ACAD lakes sampled in 2023 and raw sample depth. </p>
```{r message = FALSE, warning = FALSE}
lakes23 <- c("ACBUBL", "ACEAGL", "ACECHO", "ACJORD", "ACLONG", "ACROUN", 
             "ACSEAL", "ACUBRK", "ACUHAD", "ACWHOL")
plotLakeProfile(park = "ACAD", site = lakes23, parameter = "Temp_C", 
                depth_type = 'raw', years = 2023)

```

<p class = 'fxn'>Plot DO all ACAD lakes sampled in 2023 and raw sample depth, using reversed ryb palette. Temperature thermocline is also included as black lines.</p>
```{r message = FALSE, warning = FALSE}
plotLakeProfile(park = "ACAD", site = lakes23, 
                parameter = "DOsat_pct", depth_type = 'raw', years = 2023, 
                palette = 'ryb', color_rev = TRUE)

```

<p class = 'fxn'>Plot specific conductance for Seal Cove Pond from 2013 to 2023 and sample elevation. Uses spectral palette by default and adds site name as title by default. Thermocline is also plotted as default. </p>
```{r message = FALSE, warning = FALSE}
plotLakeProfile(site = "ACSEAL", parameter = "SpCond_uScm", 
                depth_type = 'elev', years = 2013:2023)

```

<p class = 'fxn'>Plot pH for Jordan Pond from 2013 to 2023 and sample elevation, using reversed spectral palette. </p>
```{r message = FALSE, warning = FALSE}
plotLakeProfile(site = "ACJORD", parameter = "pH", 
                depth_type = 'elev', years = 2013:2023, 
                color_rev = TRUE)

```

<p class = 'fxn'>Plot pH for all ACAD lakes sampled in 2022 and 2023 and raw sample depth, using reversed ryb palette. </p>
```{r message = FALSE, warning = FALSE}
plotLakeProfile(park = "ACAD", site = c("ACBUBL", "ACEAGL", "ACECHO", "ACJORD", "ACLONG", "ACSEAL", 
                                        "ACUHAD", "ACWHOL"), 
                parameter = "pH", depth_type = 'raw', years = 2022:2023, 
                palette = 'ryb', color_rev = TRUE)

```

</details>
<br>

<details open><summary class='drop'>Combining plots</summary>
<p class = 'fxn'>Combine plots for temp, DO, pH, and conductance in Bubble Pond for 2023 using the `cowplot` package.</p>
To minimize typing, I define the parameters I wanted at the beginning. This allows you to adjust the parameters once (i.e., change site), and run through the rest of the code without having to edit it. I also only included the plot title on the first figure, and turned it off for the rest.

The `cowplot` package must be installed to use this code. Install the package via `install.packages('cowplot')`. There are other packages to combine plots, including `grid` and `gridExtra`, and the function `ggarrage()` in `ggpubr`. I tend to start with cowplot, because it's easy to use and has a great <a href="https://wilkelab.org/cowplot/">help page</a>. If I really need to customize a plot (like custom spacing for each plot), then I use `grid/gridExtra`, which allows for more customization, but is a bit harder to work with.  
```{r message = FALSE, warning = FALSE}
library(cowplot)
sitecode = "ACBUBL"
sitename = getSites(site = sitecode)$SiteName
year = 2023
mon = 5:10
depth = 'elev'
ptitle = F

tplot <- plotLakeProfile(site = sitecode, parameter = "Temp_C", depth_type = depth,
                         years = year, months = mon, plot_title = ptitle)

doplot <- plotLakeProfile(site = sitecode, parameter = "DOsat_pct", depth_type = depth,
                          years = year, months = mon, color_rev = T, plot_title = ptitle)

pHplot <- plotLakeProfile(site = sitecode, parameter = "pH", depth_type = depth,
                          years = year, months = mon, palette = "ryb", color_rev = T,
                          plot_title = ptitle)

cnplot <- plotLakeProfile(site = sitecode, parameter = "SpCond_uScm", depth_type = depth,
                         years = year, months = mon, palette = 'rb',
                         plot_title = ptitle)

# Default settings
plot_grid(tplot, doplot, pHplot, cnplot)
```

<p class = 'fxn'>Same plot as above, but customize plot widths, so DO and SpCond have more space for legend, and add title above the grid.</p>
In this case, we're creating the plot grid with relative widths for each plot. Then we're combining the title and the plot grid in another grid, setting the title height to be much smaller than the plot grid. 

Note that sitename and year are defined in code chunk above.
```{r warning = F, message = F}
title <- ggdraw() + draw_label(paste0(sitename, " (", year, ")"), size = 11, fontface = 'bold',
                               x = 0.05, hjust = 0, vjust = 0) 
pgrid <- plot_grid(tplot, doplot, pHplot, cnplot, rel_widths = c(0.9, 0.95, 0.85, 1)) # doesn't seem to be working 
plot_grid(title, pgrid, ncol = 1, rel_heights = c(0.1, 1))
```

</details>

#### plotPrecipDischarge()
This function produces a plot with dual y-axes, one for precipitation and one for discharge. The x-axis is date. This function only works for one stream monitoring site at a time. Note that ggplot tends to have a lot of warnings that are hard to suppress, particularly for this plot, which has a daily value for precipitation and only monthly values for discharge. You're always going to get a message about that by using this function. Function currently only plots years where discharge is collected. Discharge is plotted as points and not lines, because discharge can change a lot between sampling events.

<p class = 'fxn'>Plot Discharge for Mill Brook in MIMA for past 5 years using default colors. </p>
```{r message=FALSE, warning=FALSE}
plotPrecipDischarge(site = c("MIMASA"), years = 2019:2023)

```
<p class = 'fxn'>Plot Discharge for Aunt Betty Inlet and Kebo Stream for 2022 using different colors. Note that this can be slow because has to download precip. data from NADP. LNETN parks download from a faster web service. </p>
```{r message=FALSE, warning=FALSE}
plotPrecipDischarge(site = c("ACABIN", "ACKEBO"), years = 2022, colors = c("cornflowerblue", "orange"))

```

#### plotClimTrend()
This function produces a line or smoothed trend plot filtered on park, site, year, month, and climate parameter. If multiple sites are specified, they can either be plotted on the same figure or separate figures. If multiple parameters are specified, they will be plotted on separate figures. For multiple sites to plot on the same figure, use facet_site = FALSE. For multiple parameters on the same figure, facet_param = FALSE. Note that all months (1:12) are default. If you only want sample months, specify months = 5:10.


<p class = 'fxn'>Plot monthly weather station data for Pogue Stream in MABI from 2006:2023 (all months is default), without a smoothed line.</p>
```{r}
plotClimTrend(site = "MABIPA", years = 2006:2023, parameter = "ws_ppt_mm", smooth = F)
```
<p class = 'fxn'>Plot monthly weather station data for Pogue Stream in MABI from 2006:2023, with smoothed line and span 0.7.</p>
```{r}
plotClimTrend(site = "MABIPA", years = 2006:2023, parameter = "ws_ppt_mm", span = 0.7)
```


<p class = 'fxn'>Plot monthly Daymet min, max and mean temperature for Pogue Stream in MABI and Kroma Kill in SARA from 2006:2023, with smoothed line, span 0.7, only sample months, and sites on separate plots, but parameters on the same plots. </p>
```{r}
plotClimTrend(site = c("MABIPA", "SARASA"), years = 2006:2023, 
              parameter = c("dm_tmean_C", "dm_tmax_C", "dm_tmin_C"), 
              span = 0.7, months = 5:10, facet_site = TRUE, facet_param = F,
              legend_position = "bottom")
```

#### plotClimComps()
This function compares 30-year normals (1980 - 2009, or 1990 - 2019), or decadal (1980 - 1989, ..., 2010 - 2019) average monthly climate variables with user-specified years to provide an idea of how extreme or normal a given month in a year is. 

By default, this function works with Daymet data, and so is not always available for the given year. By specifying data_type = 'wstn', data from the nearest weather station is compared with Daymet data extracted from the lat/long coordinates of the nearest weather station. <b style="font-color:red;">NOTE THAT PRELIMINARY COMPARISONS BETWEEN DAYMET AND WEATHER STATION DATA INDICATE BIAS. I'M CURRENTLY TESTING THE USE OF PRISM INSTEAD</b>

<details open><summary class='drop'>Single parameter</summary>
<p class = 'fxn'>Plot mean monthly temp for The Pogue in MABI for 2019:2023 and all months with red-blue color palette and the 4 decadal averages.</p>
```{r}
plotClimComps(site = "MABIPA", years = 2019:2023, parameter = "tmean", 
              palette = c("red", "blue"), averages = "decades")
```
<p class = 'fxn'>Same as above, but with points and 30-year normal starting at 1990.</p>
```{r}
plotClimComps(site = "MABIPA", years = 2019:2023, parameter = "tmean", palette = c("red", "blue"), 
              layers = c('points', 'lines'), averages = "norm90")
```
<p class = 'fxn'>Plot max monthly temp for Eagle Lake and Jordan Pond for 2019:2023 and sample months only, with 'viridis' palette and 30-year norm starting at 1980 (default).</p>

```{r}
plotClimComps(site = c("ACEAGL", "ACJORD"), years = 2019:2023, months = 5:10,
              parameter = "tmax", palette = "viridis", layers = 'lines')
```
<p class = 'fxn'>Plot total monthly precip for Jordan Pond for past 5 years using yellow-blue color palette, compared with the 30-year norm starting at 1980.</p>
```{r}
plotClimComps(site = "ACJORD", years = 2018:2023, parameter = 'ppt', 
              palette = c("#E8E62C", "blue"))
```

<p class = 'fxn'>Plot total monthly precip for Jordan Pond for current year using red for 2023 and blue for 2024</p>
```{r}
plotClimComps(site = "ACJORD", years = 2023:2024, parameter = 'ppt', 
              palette = c("red", "blue"), data_type = 'wstn')
```

<p class = 'fxn'>Plot total monthly max temp for Jordan Pond for current year using red for current year color.</p>
```{r}
plotClimComps(site = "ACJORD", years = 2024, parameter = 'tmean', 
              palette = c("red"), data_type = 'wstn')
```


</details><br>

<details open><summary class = 'drop'>Multiple plots</summary>

The code below would take a lot to program into waterNETN functions, so I'm instead showing you how you can create panels of multiple plots using the cowplot package. 

<p class = 'fxn'>Generate grid of all parameters in Eagle Lake from past 10 years</p> 
Note that the code that names leg is extracting a legend from a copy of the figures to be plotted separately from the other figures. This allows you to control the sizing and alignment better. The NULLs also allow you to create white space between plots.
```{r}
tmax <- plotClimComps(site = "ACEAGL", years = 2013:2023, parameter = "tmax", months = 5:10,
                      layers = 'lines', legend_position = 'none', palette = c("red", "blue"))

tmin <- plotClimComps(site = "ACEAGL", years = 2013:2023, parameter = "tmin", months = 5:10, 
                      layers = 'lines', legend_position = 'none', palette = c("red", "blue"))
tmean <- plotClimComps(site = "ACEAGL", years = 2013:2023, parameter = "tmean", months = 5:10, 
                       layers = 'lines', legend_position = 'none', palette = c("red", "blue"))
prec <- plotClimComps(site = "ACEAGL", years = 2013:2023, parameter = 'ppt', months = 5:10, 
                      layers = 'lines', legend_position = 'none', palette = c("red", "blue"))

prec_leg <- plotClimComps(site = "ACEAGL", years = 2013:2023, parameter = 'tmax', months = 5:10, 
                          layers = 'lines', legend_position = 'right', palette = c("red", "blue")) +
 theme(legend.box.margin = margin(0, 0, 0, 5), 
       legend.text = element_text(size = 9), 
       legend.title = element_text(size = 9))

leg <- cowplot::get_plot_component(
  prec_leg,
  'guide-box-right',
  return_all = T
  )


grid1 <- cowplot::plot_grid(tmean, tmax, NULL, tmin, prec, NULL, 
                            nrow = 2, ncol = 3, rel_widths = c(1, 1, 0.05, 1, 1, 0.05))
grid2 <- cowplot::plot_grid(grid1, NULL, leg, ncol = 3, nrow = 1, rel_widths = c(1, 0.05, 0.3))
grid2
```

<p class = 'fxn'>Generate grid of all parameters in Eagle Lake for 2024, Jan through April.</p>
Because waterNETN plotting functions return ggplot objects, we can tweak the plots so that temp plots all have the same y axis (so you can see that max is higher than min). 
```{r}
wstn_temp <- sumClimMonthly(site = "ACEAGL", years = 2024, data_type = "wstn") 
avg_temp <- sumClimAvgs(site = "ACEAGL", data_type = "daymet")

ymin <- round(min(wstn_temp$ws_tmin_C, avg_temp$tmin_C_d1980, avg_temp$tmin_C_d1990, 
              avg_temp$tmin_C_d2000, avg_temp$tmin_C_d2010), 0) - 1

ymax <- round(max(wstn_temp$ws_tmax_C, avg_temp$tmax_C_d1980, avg_temp$tmax_C_d1990, 
              avg_temp$tmax_C_d2000, avg_temp$tmax_C_d2010), 0) - 1

tmax <- plotClimComps(site = "ACEAGL", years = 2024, parameter = "tmax", data_type = "wstn",
                      layers = 'lines', legend_position = 'none', palette = c("red", "blue"),
                      plot_title = F) +
        ylim(ymin, ymax)
tmin <- plotClimComps(site = "ACEAGL", years = 2024, parameter = "tmin", data_type = "wstn", 
                      layers = 'lines', legend_position = 'none', palette = c("red", "blue"),
                      plot_title = F) +
        ylim(ymin, ymax)
tmean <- plotClimComps(site = "ACEAGL", years = 2024, parameter = "tmean", data_type = "wstn",
                       layers = 'lines', legend_position = 'none', palette = c("red", "blue"),
                      plot_title = F)+
        ylim(ymin, ymax)
prec <- plotClimComps(site = "ACEAGL", years = 2024, parameter = 'ppt', data_type = "wstn",
                      layers = 'lines', legend_position = 'none', palette = c("red", "blue"),
                      plot_title = F)

prec_leg <- plotClimComps(site = "ACEAGL", years = 2024, parameter = 'tmax', data_type = "wstn",
                          layers = 'lines', legend_position = 'right', 
                          palette = c("red", "blue")) +
 theme(legend.box.margin = margin(0, 0, 0, 5), 
       legend.text = element_text(size = 9), 
       legend.title = element_text(size = 9))

leg <- cowplot::get_plot_component(
  prec_leg,
  'guide-box-right',
  return_all = T
  )


grid1 <- cowplot::plot_grid(tmean, tmax, NULL, tmin, prec, NULL, 
                            nrow = 2, ncol = 3, rel_widths = c(1, 1, 0.05, 1, 1, 0.05))
grid2 <- cowplot::plot_grid(grid1, NULL, leg, ncol = 3, nrow = 1, rel_widths = c(1, 0.05, 0.3))
grid2
```
</details>

#### plotClimRel()
This function plots a given year compared against either the 1980 - 2009 normal or the 1990 - 2019 normal. The 30-year normals are derived from Daymet data. The annual comparisons are derived from the nearest weather station to each park. You can either plot all temp variables, min/max temp, mean temp or precipitation. If multiple years are specified, resulting plots will facet on year. You can make your own palette by specifying colors, or by default use viridis. Currently can only plot one site at a time. <b style="font-color:red;">NOTE THAT PRELIMINARY COMPARISONS BETWEEN DAYMET AND WEATHER STATION DATA INDICATE BIAS. I'M CURRENTLY TESTING THE USE OF PRISM INSTEAD</b>

<p class = 'fxn'>Plot all temperature variables on 1 graph for the Pogue in 2024.</p>
```{r message = F, warning = FALSE}
plotClimRel(site = "MABIPA", years = 2024, parameter = "temp", palette = c("#75C5FF", "#3563DD", "#323969"))
```

<p class = 'fxn'>Plot precip for Kroma Kill in SARA 2023 compared to 1990 - 2019 normals.</p>
```{r message = F, warning = FALSE}
plotClimRel(site = "SARASA", years = 2023, parameter = "ppt", palette = "grey", averages = "norm90")
```

<p class = 'fxn'>Plot precip for Kroma Kill in SARA 2023 and 2024 compared to 1990 - 2019 normals.</p> 
```{r message = F, warning = FALSE}
plotClimRel(site = "SARASA", years = 2023:2024, parameter = "ppt", 
            palette = "grey", averages = "norm90")
```

#### plotClimDrought()
This function plots weekly drought index at the county level for each specified park or weather station nearest to a specified park. Resulting plot shows the percent of county area in 5 levels of drought, with D0 = Abnormally Dry, D1 = Moderate Drought, D2 = Severe Drought, D3 = Extreme Drought, and D4 = Exceptional Drought. Drought designations come from the U.S. Drought Monitor. If multiple parks are specified, results will be faceted with a separate plot for each park. Where multiple counties occur in a park, data can be faceted by county if `dom_county = FALSE`. To only plot predominant county, specify `dom_county = TRUE` (default).

<p class='fxn'>Plot drought info for MABI and SAGA for 2020 to 2024</p>
```{r}
plotClimDrought(park = c("MABI", "SAGA"), years = 2020:2024)
```


<p class='fxn'>Plot drought info for both MORR counties for 2023</p>
```{r}
 plotClimDrought(park = "MORR", years = 2023, dom_county = FALSE)
```

<p class="fxn">Plot drought info for ACAD counties in 2024</p>
```{r message = F, warning = F}
plotClimDrought(park = "ACAD", years = 2024, dom_county = FALSE)
```

### Summary Functions {.tabset}
#### sumClimAvgs()
This function calculates monthly decadal and 30-year norms from daily Daymet data by site. For each decade from 1980 to 2020 and for 30-year spans through 2020, this function returns monthly averages for total precipitation in mm (ppt_mm), average maximum temperature (tmax_C),average minimum temperature (tmin_C), and average temperature (tmean_C) based on Daymet gridded climate data. The 30-year norms from 1980 - 2009 and 1990 - 2019 are designated by _30yr_1980 for 1980-2009, and _30yr_1990 for 1990 - 2020. Averages by decade are designated by _d1980 for 1980-1989, _d1990 for 1990 - 1999, etc. Note that Daymet data are downloaded from an online web service and can be slow if many sites selected, and occasionally the server is down that will result in an error message.

<p class = 'fxn'>Summarize 1980 - 2009 30-year normals for all MIMA sites.</p>
```{r}
mimaavgs <- sumClimAvgs(park = "MIMA")
print_head(mimaavgs)
```

<p class = 'fxn'>Summarize 1990 - 2019 30-year normals for Weir Pond.</p>
```{r}
weirpond <- sumClimAvgs(site = "WEFAPA")
print_head(weirpond)
```

#### sumClimMonthly()
This function calculates monthly statistics from daily Daymet and/or weather station data by site. Statistics returned are monthly total precipitation in mm (ppt_mm), average maximum temperature (tmax_C), average minimum temperature (tmin_C), and average temperature (tmean_C). When Daymet data are requested, results also return a solar radiation (srad in mjm2), potential evapotranspiration using Hargreaves (PEThar), water balance (BAL), 1- month and 3-month Standardized Precipitation Evapotranspiration Index (SPEI), a drought index that takes into account precipitation, temperature, evapotranspiration, and solar radiation. The 3-month SPEI will be NA for the first 2 months in the year span, because it's a 3-month average. Daymet vs. weather station metrics are indicated by whether they start with dm_ or ws_. Note that occasionally you're unable to connect to the Daymet or rcc-acis server and will receive and error message when that happens. 

Note that Daymet data availability are typically not available for the latest year until a few months after the calendar year is over. Weather station data may be available within a day or two of the current date.

<p class = 'fxn'>Summarize monthly Daymet and weather station data for Mill Brook in MIMA for 2020 to 2023.</p>
```{r}
mima <- sumClimMonthly(site = "MIMASA", years = 2020:2023, data_type = 'all')
print_head(mima)

```

<p class = 'fxn'>Summarize monthly weather station data for the Pogue for 2024. </p>
```{r}
pogwstn <- sumClimMonthly(site = "MABIPA", years = 2024, data_type = 'wstn')
print_head(pogwstn)
```
